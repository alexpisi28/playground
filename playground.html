<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Playground Modes</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #000;
  }

  body {
    transition: filter 0.4s ease, background-color 0.4s ease;
    background-color: #000;
    filter: brightness(1);
  }

  body.dimmed {
    filter: brightness(0.5);
    background-color: #000;
  }

  body.brightened {
    filter: brightness(1.3);
    background-color: #222;
  }

  /* MENU */
  #menu {
    width: 100vw;
    height: 100vh;
    background: #222;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 40px;
  }

  .menu-button {
    padding: 20px 40px;
    font-size: 2rem;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: #444;
    color: white;
    transition: 0.2s;
  }

  .menu-button:hover {
    background: #666;
  }

  /* BACK BUTTON */
  .back-button {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 12px 20px;
    font-size: 1.2rem;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: rgba(0,0,0,0.6);
    color: white;
    z-index: 999;
  }

  /* TILE WORLD */
  #tile-world-container {
    display: none;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    position: relative;
  }

  #world {
    position: absolute;
    top: 0;
    left: 0;
    display: grid;
    width: 100vw;
    height: 100vh;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
  }

  .tile {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4rem;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    animation: popIn 0.3s ease;
  }

  @keyframes popIn {
    from { transform: scale(0.7); opacity: 0; }
    to   { transform: scale(1); opacity: 1; }
  }

  .move-up    { animation: moveUp 0.25s ease; }
  .move-down  { animation: moveDown 0.25s ease; }
  .move-left  { animation: moveLeft 0.25s ease; }
  .move-right { animation: moveRight 0.25s ease; }

  @keyframes moveUp    { from { transform: translateY(80px); } to { transform: translateY(0); } }
  @keyframes moveDown  { from { transform: translateY(-80px); } to { transform: translateY(0); } }
  @keyframes moveLeft  { from { transform: translateX(80px); } to { transform: translateX(0); } }
  @keyframes moveRight { from { transform: translateX(-80px); } to { transform: translateX(0); } }

  body.rainbow-mode .tile {
    animation: colorShift 1.5s linear infinite alternate;
  }

  @keyframes colorShift {
    0%   { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(90deg); }
  }

  #message {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    border-radius: 999px;
    background: rgba(0,0,0,0.6);
    color: white;
    font-size: 1.2rem;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 1000;
  }

  #message.visible {
    opacity: 1;
  }

  /* COLOR SPLASH */
  #color-splash {
    display: none;
    width: 100vw;
    height: 100vh;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: background 0.6s ease, filter 0.6s ease;
  }

  #animal {
    position: absolute;
    font-size: 10rem;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.2);
    opacity: 0;
    transition: transform 0.4s ease, opacity 0.4s ease;
    pointer-events: none;
    filter: drop-shadow(0 0 10px rgba(0,0,0,0.4));
  }

  #animal.show {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }

  /* COLOR SPLASH RAINBOW GRADIENT */
  #color-splash.rainbow-gradient {
    background: linear-gradient(120deg, red, orange, yellow, green, blue, indigo, violet);
    background-size: 400% 400%;
    animation: rainbowShift 6s ease infinite;
  }

  @keyframes rainbowShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* COLOR SPLASH DIM / BRIGHT */
  #color-splash.moon-mode {
    filter: brightness(0.7);
  }

  #color-splash.sun-mode {
    filter: brightness(1.3);
  }

  /* COLOR SPLASH FIRE PULSE */
  #color-splash.fire-mode {
    background: radial-gradient(circle at center, #FF9F1C, #FF6B6B, #6A4C93);
    animation: firePulse 3s ease-in-out infinite;
  }

  @keyframes firePulse {
    0%, 100% { filter: brightness(1); }
    50%      { filter: brightness(1.2); }
  }

  /* COLOR SPLASH OVERLAYS */
  .cs-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 10;
  }

  .snowflake {
    position: absolute;
    font-size: 2rem;
    animation: fallSnow 4s linear forwards;
  }

  @keyframes fallSnow {
    0% { transform: translateY(-10%); opacity: 1; }
    100% { transform: translateY(110%); opacity: 0; }
  }

  .petal {
    position: absolute;
    font-size: 2rem;
    animation: fallPetal 4s ease-in forwards;
  }

  @keyframes fallPetal {
    0% { transform: translateY(-10%) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110%) rotate(120deg); opacity: 0; }
  }

  .sparkle-dot {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: white;
    box-shadow: 0 0 8px rgba(255,255,255,0.8);
    animation: sparkleOut 0.7s ease-out forwards;
  }

  @keyframes sparkleOut {
    0%   { transform: scale(0.3); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
  }

  /* LIGHTNING FLICKER */
  #color-splash.lightning-flicker {
    animation: lightningFlicker 0.4s ease-in-out;
  }

  @keyframes lightningFlicker {
    0% { filter: brightness(1.4); }
    50% { filter: brightness(0.6); }
    100% { filter: brightness(1); }
  }

  /* LIGHTBULB FLASH */
  #color-splash.flash {
    animation: flashOnce 0.4s ease;
  }

  @keyframes flashOnce {
    0% { filter: brightness(2); }
    100% { filter: brightness(1); }
  }

  /* FULLSCREEN EXIT CIRCLE */
  #exit-circle {
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 30px;
    height: 30px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    opacity: 0.1;
    z-index: 99999;
    display: none;
    transition: opacity 0.3s, transform 0.3s;
  }

  #exit-circle.active {
    opacity: 0.5;
    transform: translateX(-50%) scale(1.4);
  }

  #exit-fullscreen-btn {
    position: fixed;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 30px;
    font-size: 1.5rem;
    border-radius: 12px;
    background: rgba(0,0,0,0.7);
    color: white;
    display: none;
    z-index: 100000;
  }
</style>
</head>
<body>

<!-- MENU -->
<div id="menu">
  <h1>Choose a Mode</h1>
  <button class="menu-button" onclick="startTileWorld()">Tile World</button>
  <button class="menu-button" onclick="startColorSplash()">Color Splash</button>
  <button class="menu-button" onclick="enterFullscreenMode()">Fullscreen Mode</button>
</div>

<!-- TILE WORLD -->
<div id="tile-world-container">
  <button class="back-button" onclick="returnToMenu()">‚Üê Back</button>
  <div id="message"></div>
  <div id="world"></div>
</div>

<!-- COLOR SPLASH -->
<div id="color-splash">
  <button class="back-button" onclick="returnToMenu()">‚Üê Back</button>
  <div id="animal"></div>
</div>

<!-- FULLSCREEN EXIT ELEMENTS -->
<div id="exit-circle"></div>
<button id="exit-fullscreen-btn" onclick="exitFullscreen()">Exit Fullscreen</button>

<script>
/* -----------------------------
   FULLSCREEN MODE
----------------------------- */

function enterFullscreenMode() {
  if (document.fullscreenElement) {
    // already fullscreen; just show menu inside
    showFullscreenMenu();
    return;
  }
  document.documentElement.requestFullscreen().then(showFullscreenMenu).catch(showFullscreenMenu);
}

function showFullscreenMenu() {
  document.getElementById("tile-world-container").style.display = "none";
  document.getElementById("color-splash").style.display = "none";
  document.getElementById("menu").style.display = "flex";
  enableExitCircle();
}

function enableExitCircle() {
  const circle = document.getElementById("exit-circle");
  circle.style.display = "block";

  let pressTimer = null;

  circle.onmousedown = () => {
    circle.classList.add("active");
    pressTimer = setTimeout(() => {
      document.getElementById("exit-fullscreen-btn").style.display = "block";
    }, 2000);
  };

  circle.onmouseup = () => {
    circle.classList.remove("active");
    clearTimeout(pressTimer);
  };

  circle.onmouseleave = () => {
    circle.classList.remove("active");
    clearTimeout(pressTimer);
  };
}

function exitFullscreen() {
  if (document.fullscreenElement) {
    document.exitFullscreen();
  }
  document.getElementById("exit-circle").style.display = "none";
  document.getElementById("exit-fullscreen-btn").style.display = "none";
  returnToMenu();
}

/* -----------------------------
   MODE SWITCHING
----------------------------- */

function returnToMenu() {
  document.body.classList.remove("rainbow-mode", "dimmed", "brightened");
  document.getElementById("tile-world-container").style.display = "none";
  document.getElementById("color-splash").style.display = "none";
  document.getElementById("menu").style.display = "flex";
}

function startTileWorld() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("tile-world-container").style.display = "block";
  fillScreenWithTiles();
}

function startColorSplash() {
  document.getElementById("menu").style.display = "none";
  const splash = document.getElementById("color-splash");
  splash.style.display = "block";
  resetColorSplashModes();
  changeSplashColor();

  splash.onclick = changeSplashColor;

  window.onwheel = (e) => {
    if (splash.style.display !== "block") return;
    e.preventDefault();
    changeSplashColor();
  };
}

/* -----------------------------
   AUDIO ENGINE (SHARED)
----------------------------- */

let audioCtx = null;

function ensureAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playSpecialTone(freq, duration = 0.3, type = "sine") {
  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = type;
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

  gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

function playGliss(startFreq, endFreq, duration = 0.4) {
  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "triangle";
  osc.frequency.setValueAtTime(startFreq, audioCtx.currentTime);
  osc.frequency.linearRampToValueAtTime(endFreq, audioCtx.currentTime + duration);

  gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

/* -----------------------------
   COLOR SPLASH ‚Äî ANIMAL TONES
----------------------------- */

const animalFrequencies = {
  "üê∂": 440, "üê±": 523, "üê∞": 587, "ü¶ä": 659,
  "üêª": 392, "üêº": 349, "üê∏": 330, "üêµ": 494,
  "üêØ": 622, "ü¶Å": 698, "üêÆ": 262, "üê∑": 294
};

const ANIMAL_EMOJIS = Object.keys(animalFrequencies);

function playAnimalTone(emoji) {
  const freq = animalFrequencies[emoji];
  if (!freq) return;

  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "square";
  osc.frequency.value = freq;

  gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.25);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.25);
}

/* -----------------------------
   COLOR SPLASH ‚Äî SPECIAL MODES
----------------------------- */

const splashSpecialEmojis = [
  "üéÅ","üåà","‚≠ê","üåô","‚òÄÔ∏è","üí°","‚ö°","‚ùÑÔ∏è","üî•","üåº"
];

function resetColorSplashModes() {
  const splash = document.getElementById("color-splash");
  splash.classList.remove(
    "rainbow-gradient",
    "moon-mode",
    "sun-mode",
    "fire-mode",
    "lightning-flicker",
    "flash"
  );
  removeSplashOverlays();
}

function removeSplashOverlays() {
  const splash = document.getElementById("color-splash");
  splash.querySelectorAll(".cs-overlay").forEach(el => el.remove());
}

/* CONFETTI */
function splashConfetti() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  for (let i = 0; i < 60; i++) {
    const piece = document.createElement("div");
    piece.style.position = "absolute";
    piece.style.width = "10px";
    piece.style.height = "10px";
    piece.style.background = randomConfettiColor();
    piece.style.left = Math.random() * 100 + "%";
    piece.style.top = "-10%";

    piece.animate(
      [
        { transform: "translateY(0)", opacity: 1 },
        { transform: "translateY(120vh)", opacity: 0 }
      ],
      { duration: 2000 + Math.random() * 1000, easing: "linear" }
    );

    overlay.appendChild(piece);
  }

  setTimeout(() => overlay.remove(), 3500);
}

function randomConfettiColor() {
  const colors = ["#FF6B6B", "#FFD93D", "#6BCB77", "#4D96FF", "#E96479"];
  return colors[Math.floor(Math.random() * colors.length)];
}

/* SNOW */
function splashSnow() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  for (let i = 0; i < 40; i++) {
    const flake = document.createElement("div");
    flake.className = "snowflake";
    flake.textContent = "‚ùÑÔ∏è";
    flake.style.left = Math.random() * 100 + "%";
    flake.style.top = "-10%";
    flake.style.fontSize = (Math.random() * 1.5 + 1) + "rem";

    overlay.appendChild(flake);
  }

  setTimeout(() => overlay.remove(), 4500);
}

/* PETALS */
function splashPetals() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  for (let i = 0; i < 40; i++) {
    const petal = document.createElement("div");
    petal.className = "petal";
    petal.textContent = "üå∏";
    petal.style.left = Math.random() * 100 + "%";
    petal.style.top = "-10%";
    petal.style.fontSize = (Math.random() * 1.5 + 1) + "rem";

    overlay.appendChild(petal);
  }

  setTimeout(() => overlay.remove(), 4500);
}

/* SPARKLES */
function splashSparkles() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  for (let i = 0; i < 25; i++) {
    const dot = document.createElement("div");
    dot.className = "sparkle-dot";
    dot.style.left = Math.random() * 100 + "%";
    dot.style.top = Math.random() * 100 + "%";
    overlay.appendChild(dot);
  }

  setTimeout(() => overlay.remove(), 800);
}

/* -----------------------------
   COLOR SPLASH ‚Äî MAIN LOGIC
----------------------------- */

function changeSplashColor() {
  const splash = document.getElementById("color-splash");
  const animal = document.getElementById("animal");

  resetColorSplashModes();

  const randomColor = `hsl(${Math.random() * 360}, 80%, 60%)`;
  splash.style.background = randomColor;

  const emoji = ANIMAL_EMOJIS[Math.floor(Math.random() * ANIMAL_EMOJIS.length)];
  animal.textContent = emoji;

  animal.classList.remove("show");
  void animal.offsetWidth;
  animal.classList.add("show");

  playAnimalTone(emoji);

  if (Math.random() < 0.25) {
    triggerSplashSpecial();
  }
}

function triggerSplashSpecial() {
  const splash = document.getElementById("color-splash");
  const emoji = splashSpecialEmojis[Math.floor(Math.random() * splashSpecialEmojis.length)];

  switch (emoji) {
    case "üåà":
      splash.classList.add("rainbow-gradient");
      playGliss(300, 900);
      break;

    case "üåô":
      splash.classList.add("moon-mode");
      playSpecialTone(220);
      break;

    case "‚òÄÔ∏è":
      splash.classList.add("sun-mode");
      playSpecialTone(880);
      break;

    case "üî•":
      splash.classList.add("fire-mode");
      playGliss(200, 600);
      break;

    case "‚ö°":
      splash.classList.add("lightning-flicker");
      playSpecialTone(1200, 0.2, "sawtooth");
      break;

    case "üí°":
      splash.classList.add("flash");
      playSpecialTone(1000, 0.15);
      break;

    case "‚ùÑÔ∏è":
      splashSnow();
      playSpecialTone(300);
      break;

    case "üåº":
      splashPetals();
      playSpecialTone(500);
      break;

    case "‚≠ê":
      splashSparkles();
      playGliss(500, 1200);
      break;

    case "üéÅ":
      splashConfetti();
      playGliss(400, 900);
      break;
  }
}

/* -----------------------------
   TILE WORLD ‚Äî GLOBALS
----------------------------- */

let worldX = 0;
let worldY = 0;

const world = document.getElementById("world");
const message = document.getElementById("message");

const TILE_EMOJIS = [
  "üçé","üçä","üçã","üçâ","üçá","üçì","üçí",
  "üíé","üî∑","üî∂","‚ú®","üåü","üåà",
  "üå§Ô∏è","‚õÖ","üåßÔ∏è","‚ùÑÔ∏è","üå∏","üåº"
];

const SPECIAL_TILES = ["‚≠ê","üåà","üéÅ"];

/* -----------------------------
   TILE WORLD ‚Äî HELPERS
----------------------------- */

function randomTileEmoji() {
  if (Math.random() < 0.25) {
    return SPECIAL_TILES[Math.floor(Math.random() * SPECIAL_TILES.length)];
  }
  return TILE_EMOJIS[Math.floor(Math.random() * TILE_EMOJIS.length)];
}

function showMessage(text) {
  message.textContent = text;
  message.classList.add("visible");
  setTimeout(() => message.classList.remove("visible"), 1200);
}

/* -----------------------------
   TILE WORLD ‚Äî SPECIAL EFFECTS
----------------------------- */

function starSwap(tile) {
  playGliss(400, 900);
  showMessage("‚≠ê Star Swap!");

  const tiles = document.querySelectorAll(".tile");
  tiles.forEach(t => {
    if (Math.random() < 0.3) {
      t.textContent = TILE_EMOJIS[Math.floor(Math.random() * TILE_EMOJIS.length)];
    }
  });
}

function rainbowMode() {
  playGliss(300, 1200);
  showMessage("üåà Rainbow Mode!");
  document.body.classList.add("rainbow-mode");
  setTimeout(() => document.body.classList.remove("rainbow-mode"), 4000);
}

function superPresent() {
  playGliss(200, 800);
  showMessage("üéÅ Super Present!");

  const tiles = document.querySelectorAll(".tile");
  tiles.forEach(t => {
    if (Math.random() < 0.4) {
      t.style.background = `hsl(${Math.random()*360}, 80%, 60%)`;
    }
  });
}

/* -----------------------------
   TILE WORLD ‚Äî TILE CLICK
----------------------------- */

function handleTileClick(tile) {
  const emoji = tile.textContent;

  if (emoji === "‚≠ê") return starSwap(tile);
  if (emoji === "üåà") return rainbowMode();
  if (emoji === "üéÅ") return superPresent();

  playSpecialTone(500);
  tile.style.background = `hsl(${Math.random()*360}, 80%, 60%)`;
}

/* -----------------------------
   TILE WORLD ‚Äî GRID GENERATION
----------------------------- */

function fillScreenWithTiles() {
  world.innerHTML = "";

  for (let i = 0; i < 9; i++) {
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.textContent = randomTileEmoji();
    tile.onclick = () => handleTileClick(tile);
    world.appendChild(tile);
  }
}

/* -----------------------------
   TILE WORLD ‚Äî MOVEMENT
----------------------------- */

function moveWorld(dx, dy, directionClass) {
  worldX += dx;
  worldY += dy;

  world.classList.remove("move-up","move-down","move-left","move-right");
  void world.offsetWidth;
  world.classList.add(directionClass);

  fillScreenWithTiles();
  playSpecialTone(300 + Math.random()*200);
}

/* ARROW KEYS */
window.onkeydown = (e) => {
  if (document.getElementById("tile-world-container").style.display !== "block") return;

  if (e.key === "ArrowUp") moveWorld(0, -1, "move-up");
  if (e.key === "ArrowDown") moveWorld(0, 1, "move-down");
  if (e.key === "ArrowLeft") moveWorld(-1, 0, "move-left");
  if (e.key === "ArrowRight") moveWorld(1, 0, "move-right");
};

/* SWIPE MOVEMENT */
let touchStartX = 0;
let touchStartY = 0;

window.addEventListener("touchstart", (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
});

window.addEventListener("touchend", (e) => {
  if (document.getElementById("tile-world-container").style.display !== "block") return;

  const dx = e.changedTouches[0].clientX - touchStartX;
  const dy = e.changedTouches[0].clientY - touchStartY;

  if (Math.abs(dx) > Math.abs(dy)) {
    if (dx > 40) moveWorld(1, 0, "move-right");
    if (dx < -40) moveWorld(-1, 0, "move-left");
  } else {
    if (dy > 40) moveWorld(0, 1, "move-down");
    if (dy < -40) moveWorld(0, -1, "move-up");
  }
});
</script>

</body>
</html>
