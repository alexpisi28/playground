<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Playground Modes</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: #000;
  }

  body {
    transition: filter 0.4s ease, background-color 0.4s ease;
    background-color: #000;
    filter: brightness(1);
  }

  body.dimmed {
    filter: brightness(0.5);
    background-color: #000;
  }

  body.brightened {
    filter: brightness(1.3);
    background-color: #222;
  }

  /* MENU */
  #menu {
    width: 100vw;
    height: 100vh;
    background: #222;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 40px;
  }

  .menu-button {
    padding: 20px 40px;
    font-size: 2rem;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    background: #444;
    color: white;
    transition: 0.2s;
  }

  .menu-button:hover {
    background: #666;
  }

  /* BACK BUTTON */
  .back-button {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 12px 20px;
    font-size: 1.2rem;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: rgba(0,0,0,0.6);
    color: white;
    z-index: 999;
  }

  /* TILE WORLD */
  #tile-world-container {
    display: none;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    position: relative;
  }

  #world {
    position: absolute;
    top: 0;
    left: 0;
    display: grid;
    width: 100vw;
    height: 100vh;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
  }

  .tile {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 4rem;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    animation: popIn 0.3s ease;
  }

  @keyframes popIn {
    from { transform: scale(0.7); opacity: 0; }
    to   { transform: scale(1); opacity: 1; }
  }

  .move-up    { animation: moveUp 0.25s ease; }
  .move-down  { animation: moveDown 0.25s ease; }
  .move-left  { animation: moveLeft 0.25s ease; }
  .move-right { animation: moveRight 0.25s ease; }

  @keyframes moveUp    { from { transform: translateY(80px); } to { transform: translateY(0); } }
  @keyframes moveDown  { from { transform: translateY(-80px); } to { transform: translateY(0); } }
  @keyframes moveLeft  { from { transform: translateX(80px); } to { transform: translateX(0); } }
  @keyframes moveRight { from { transform: translateX(-80px); } to { transform: translateX(0); } }

  body.rainbow-mode .color-tile {
    animation: colorShift 1.5s linear infinite alternate;
  }

  @keyframes colorShift {
    0%   { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(90deg); }
  }

  .special-tile {
    background: radial-gradient(circle, gold, orange, red);
    color: white;
    text-shadow: 2px 2px 5px black;
  }

  #message {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    border-radius: 999px;
    background: rgba(0,0,0,0.6);
    color: white;
    font-size: 1.2rem;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    z-index: 1000;
  }

  #message.visible {
    opacity: 1;
  }

  /* COLOR SPLASH */
  #color-splash {
    display: none;
    width: 100vw;
    height: 100vh;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: background 0.6s ease, filter 0.6s ease;
  }

  #animal {
    position: absolute;
    font-size: 10rem;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.2);
    opacity: 0;
    transition: transform 0.4s ease, opacity 0.4s ease;
    pointer-events: none;
    filter: drop-shadow(0 0 10px rgba(0,0,0,0.4));
  }

  #animal.show {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }

  /* COLOR SPLASH RAINBOW GRADIENT */
  #color-splash.rainbow-gradient {
    background: linear-gradient(120deg, red, orange, yellow, green, blue, indigo, violet);
    background-size: 400% 400%;
    animation: rainbowShift 6s ease infinite;
  }

  @keyframes rainbowShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* COLOR SPLASH DIM / BRIGHT (local to splash) */
  #color-splash.moon-mode {
    filter: brightness(0.7);
  }

  #color-splash.sun-mode {
    filter: brightness(1.3);
  }

  /* COLOR SPLASH FIRE PULSE */
  #color-splash.fire-mode {
    background: radial-gradient(circle at center, #FF9F1C, #FF6B6B, #6A4C93);
    animation: firePulse 3s ease-in-out infinite;
  }

  @keyframes firePulse {
    0%, 100% { filter: brightness(1); }
    50%      { filter: brightness(1.2); }
  }

  /* COLOR SPLASH OVERLAY CONTAINERS */
  .cs-overlay {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 10;
  }

  .snowflake {
    position: absolute;
    font-size: 2rem;
    animation: fallSnow 4s linear forwards;
  }

  @keyframes fallSnow {
    0% { transform: translateY(-10%); opacity: 1; }
    100% { transform: translateY(110%); opacity: 0; }
  }

  .petal {
    position: absolute;
    font-size: 2rem;
    animation: fallPetal 4s ease-in forwards;
  }

  @keyframes fallPetal {
    0% { transform: translateY(-10%) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110%) rotate(120deg); opacity: 0; }
  }

  .sparkle-dot {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: white;
    box-shadow: 0 0 8px rgba(255,255,255,0.8);
    animation: sparkleOut 0.7s ease-out forwards;
  }

  @keyframes sparkleOut {
    0%   { transform: scale(0.3); opacity: 1; }
    100% { transform: scale(1.5); opacity: 0; }
  }

  /* COLOR SPLASH LIGHTNING FLICKER */
  #color-splash.lightning-flicker {
    animation: lightningFlicker 0.4s ease-in-out;
  }

  @keyframes lightningFlicker {
    0% { filter: brightness(1.4); }
    50% { filter: brightness(0.6); }
    100% { filter: brightness(1); }
  }

  /* COLOR SPLASH QUICK FLASH (LIGHTBULB) */
  #color-splash.flash {
    animation: flashOnce 0.4s ease;
  }

  @keyframes flashOnce {
    0% { filter: brightness(2); }
    100% { filter: brightness(1); }
  }
</style>
</head>
<body>

<!-- MENU -->
<div id="menu">
  <h1>Choose a Mode</h1>
  <button class="menu-button" onclick="startTileWorld()">Tile World</button>
  <button class="menu-button" onclick="startColorSplash()">Color Splash</button>
</div>

<!-- TILE WORLD -->
<div id="tile-world-container">
  <button class="back-button" onclick="returnToMenu()">‚Üê Back</button>
  <div id="message"></div>
  <div id="world"></div>
</div>

<!-- COLOR SPLASH -->
<div id="color-splash">
  <button class="back-button" onclick="returnToMenu()">‚Üê Back</button>
  <div id="animal"></div>
</div>

<script>
/* -----------------------------
   MODE SWITCHING
----------------------------- */

function returnToMenu() {
  document.body.classList.remove("rainbow-mode", "dimmed", "brightened");
  document.getElementById("tile-world-container").style.display = "none";
  document.getElementById("color-splash").style.display = "none";
  document.getElementById("menu").style.display = "flex";
}

function startTileWorld() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("tile-world-container").style.display = "block";
  fillScreenWithTiles();
}

function startColorSplash() {
  document.getElementById("menu").style.display = "none";
  const splash = document.getElementById("color-splash");
  splash.style.display = "block";
  resetColorSplashModes();
  changeSplashColor();

  splash.onclick = changeSplashColor;

  window.onwheel = (e) => {
    if (splash.style.display !== "block") return;
    e.preventDefault();
    changeSplashColor();
  };
}

/* -----------------------------
   AUDIO BASE (SHARED)
----------------------------- */

let audioCtx = null;

function ensureAudio() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playSpecialTone(freq, duration = 0.3, type = "sine") {
  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = type;
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

  gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

function playGliss(startFreq, endFreq, duration = 0.4) {
  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "triangle";
  osc.frequency.setValueAtTime(startFreq, audioCtx.currentTime);
  osc.frequency.linearRampToValueAtTime(endFreq, audioCtx.currentTime + duration);

  gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

/* -----------------------------
   COLOR SPLASH ‚Äî ANIMAL TONES
----------------------------- */

const animalFrequencies = {
  "üê∂": 440, "üê±": 523, "üê∞": 587, "ü¶ä": 659,
  "üêª": 392, "üêº": 349, "üê∏": 330, "üêµ": 494,
  "üêØ": 622, "ü¶Å": 698, "üêÆ": 262, "üê∑": 294
};

const ANIMAL_EMOJIS = Object.keys(animalFrequencies);

function playAnimalTone(emoji) {
  const freq = animalFrequencies[emoji];
  if (!freq) return;

  ensureAudio();
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "square";
  osc.frequency.value = freq;

  gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.25);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start();
  osc.stop(audioCtx.currentTime + 0.25);
}

/* -----------------------------
   COLOR SPLASH ‚Äî SPECIAL MODES
----------------------------- */

const splashSpecialEmojis = [
  "üéÅ","üåà","‚≠ê","üåô","‚òÄÔ∏è","üí°","‚ö°","‚ùÑÔ∏è","üî•","üåº"
];

let forceNextSpecial = false;

function resetColorSplashModes() {
  const splash = document.getElementById("color-splash");
  splash.classList.remove(
    "rainbow-gradient",
    "moon-mode",
    "sun-mode",
    "fire-mode",
    "lightning-flicker",
    "flash"
  );
  removeSplashOverlays();
}

function removeSplashOverlays() {
  const splash = document.getElementById("color-splash");
  splash.querySelectorAll(".cs-overlay").forEach(el => el.remove());
}

/* Confetti for Color Splash */
function splashConfetti() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  for (let i = 0; i < 60; i++) {
    const piece = document.createElement("div");
    piece.style.position = "absolute";
    piece.style.width = "10px";
    piece.style.height = "10px";
    piece.style.background = randomConfettiColor();
    piece.style.left = Math.random() * 100 + "%";
    piece.style.top = "-10%";

    piece.animate(
      [
        { transform: "translateY(0px) rotate(0deg)", opacity: 1 },
        { transform: "translateY(120vh) rotate(360deg)", opacity: 0 }
      ],
      { duration: 1400 + Math.random() * 600, easing: "ease-out", fill: "forwards" }
    );

    overlay.appendChild(piece);
  }

  setTimeout(() => overlay.remove(), 2200);
}

/* Sparkle burst at center */
function splashSparkles() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  const centerX = window.innerWidth / 2;
  const centerY = window.innerHeight / 2;

  for (let i = 0; i < 18; i++) {
    const dot = document.createElement("div");
    dot.className = "sparkle-dot";

    dot.style.left = centerX + "px";
    dot.style.top = centerY + "px";

    const angle = Math.random() * Math.PI * 2;
    const dist = 40 + Math.random() * 40;

    dot.animate(
      [
        { transform: "translate(0,0) scale(0.3)", opacity: 1 },
        { transform: `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px) scale(1.5)`, opacity: 0 }
      ],
      { duration: 600 + Math.random()*200, easing: "ease-out", fill: "forwards" }
    );

    overlay.appendChild(dot);
  }

  setTimeout(() => overlay.remove(), 800);
}

/* Snowflakes overlay */
function splashSnowflakes() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  for (let i = 0; i < 14; i++) {
    const flake = document.createElement("div");
    flake.className = "snowflake";
    flake.textContent = "‚ùÑÔ∏è";
    flake.style.left = Math.random() * 100 + "%";
    flake.style.animationDuration = (3 + Math.random() * 2) + "s";
    overlay.appendChild(flake);
  }

  setTimeout(() => overlay.remove(), 5000);
}

/* Petals overlay */
function splashPetals() {
  const splash = document.getElementById("color-splash");
  const overlay = document.createElement("div");
  overlay.className = "cs-overlay";
  splash.appendChild(overlay);

  const petalChar = "üå∏";

  for (let i = 0; i < 14; i++) {
    const petal = document.createElement("div");
    petal.className = "petal";
    petal.textContent = petalChar;
    petal.style.left = Math.random() * 100 + "%";
    petal.style.animationDuration = (3 + Math.random() * 2) + "s";
    overlay.appendChild(petal);
  }

  setTimeout(() => overlay.remove(), 5000);
}

/* Apply special mode effects based on emoji */
function triggerSplashSpecial(emoji) {
  const splash = document.getElementById("color-splash");

  splash.classList.remove(
    "rainbow-gradient",
    "moon-mode",
    "sun-mode",
    "fire-mode",
    "lightning-flicker",
    "flash"
  );
  removeSplashOverlays();

  switch (emoji) {
    case "üéÅ":
      splashConfetti();
      playGliss(440, 880, 0.5);
      break;
    case "üåà":
      splash.classList.add("rainbow-gradient");
      playGliss(660, 1320, 0.7);
      break;
    case "‚≠ê":
      splashSparkles();
      playSpecialTone(1200, 0.4, "triangle");
      break;
    case "üåô":
      splash.classList.add("moon-mode");
      playGliss(440, 330, 0.6);
      break;
    case "‚òÄÔ∏è":
      splash.classList.add("sun-mode");
      playSpecialTone(880, 0.35, "square");
      break;
    case "üí°":
      splash.classList.add("flash");
      setTimeout(() => splash.classList.remove("flash"), 400);
      playSpecialTone(1200, 0.25, "sine");
      forceNextSpecial = true;
      break;
    case "‚ö°":
      splash.classList.add("lightning-flicker");
      setTimeout(() => splash.classList.remove("lightning-flicker"), 400);
      playSpecialTone(1500, 0.2, "square");
      break;
    case "‚ùÑÔ∏è":
      splashSnowflakes();
      playSpecialTone(880, 0.5, "sine");
      break;
    case "üî•":
      splash.classList.add("fire-mode");
      playSpecialTone(220, 0.6, "sawtooth");
      break;
    case "üåº":
      splashPetals();
      playSpecialTone(660, 0.5, "triangle");
      break;
  }
}

/* -----------------------------
   COLOR SPLASH ‚Äî MAIN LOGIC
----------------------------- */

function randomFrom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function changeSplashColor() {
  const COLORS = ["#FF6B6B","#4ECDC4","#FFD93D","#6A4C93","#FF9F1C","#2EC4B6"];
  const splash = document.getElementById("color-splash");
  const animal = document.getElementById("animal");

  const baseColor = randomFrom(COLORS);
  splash.style.background = baseColor;

  let isSpecial = false;
  let chosenEmoji = null;

  if (forceNextSpecial) {
    isSpecial = true;
    forceNextSpecial = false;
  } else {
    const specialChance = 0.25;
    if (Math.random() < specialChance) {
      isSpecial = true;
    }
  }

  if (isSpecial) {
    chosenEmoji = randomFrom(splashSpecialEmojis);
  }

  const baseAnimal = randomFrom(ANIMAL_EMOJIS);
  const displayEmoji = isSpecial ? chosenEmoji : baseAnimal;

  animal.textContent = displayEmoji;

  animal.classList.remove("show");
  void animal.offsetWidth;
  animal.classList.add("show");

  playAnimalTone(baseAnimal);

  if (isSpecial && chosenEmoji) {
    triggerSplashSpecial(chosenEmoji);
  } else {
    resetColorSplashModes();
  }
}

/* -----------------------------
   TILE WORLD ‚Äî COORDINATE SYSTEM
----------------------------- */

let offsetRow = 0;
let offsetCol = 0;

const world = document.getElementById("world");
const message = document.getElementById("message");

const COLORS2 = ["#FF6B6B","#4ECDC4","#FFD93D","#6A4C93","#FF9F1C","#2EC4B6"];
const DIRECTIONS = ["‚¨ÜÔ∏è","‚¨áÔ∏è","‚¨ÖÔ∏è","‚û°Ô∏è"];

const EXTRA_EMOJIS = [
  "üçé","üçä","üçã","üçâ","üçá","üçì",
  "üåü","üíé","üî•","‚ùÑÔ∏è","‚ö°","üåº"
];

const RAINBOW_COLORS = [
  "#FF0000",
  "#FF7F00",
  "#FFFF00",
  "#00FF00",
  "#0000FF",
  "#8B00FF"
];

function seededRandom(seed) {
  const x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

function createTileAt(worldR, worldC) {
  const tile = document.createElement("div");
  tile.className = "tile";

  const baseSeed = worldR * 73856093 ^ worldC * 19349663;
  const rand = seededRandom(baseSeed);

  if (rand < 0.08) {
    tile.textContent = "üéÅ";
    tile.classList.add("special-tile");
  } else if (rand < 0.25) {
    const dirRand = seededRandom(baseSeed + 9999);
    const idx = Math.floor(dirRand * 4);
    tile.textContent = DIRECTIONS[idx];
    tile.style.background = "#333";
    tile.style.color = "white";
  } else if (rand < 0.32) {
    tile.textContent = "üåà";
    tile.classList.add("rainbow-tile");
    tile.dataset.rainbowIndex = 0;
    tile.style.background = RAINBOW_COLORS[0];
    tile.dataset.color = RAINBOW_COLORS[0];
  } else if (rand < 0.40) {
    tile.textContent = "‚≠ê";
    tile.classList.add("star-tile");
    const colorIdx = Math.floor(seededRandom(baseSeed + 4444) * COLORS2.length);
    const color = COLORS2[colorIdx];
    tile.style.background = color;
    tile.dataset.color = color;
  } else if (rand < 0.46) {
    tile.textContent = "üåô";
    const colorIdx = Math.floor(seededRandom(baseSeed + 5556) * COLORS2.length);
    const color = COLORS2[colorIdx];
    tile.style.background = color;
    tile.dataset.color = color;
  } else if (rand < 0.52) {
    tile.textContent = "‚òÄÔ∏è";
    const colorIdx = Math.floor(seededRandom(baseSeed + 5557) * COLORS2.length);
    const color = COLORS2[colorIdx];
    tile.style.background = color;
    tile.dataset.color = color;
  } else if (rand < 0.58) {
    tile.textContent = "üí°";
    const colorIdx = Math.floor(seededRandom(baseSeed + 5558) * COLORS2.length);
    const color = COLORS2[colorIdx];
    tile.style.background = color;
    tile.dataset.color = color;
  } else {
    const color = COLORS2[Math.floor(seededRandom(baseSeed + 5555) * COLORS2.length)];
    tile.style.background = color;
    tile.dataset.color = color;
    tile.classList.add("color-tile");

    const emojiRand = seededRandom(baseSeed + 7777);
    if (emojiRand < 0.5) {
      const emojiIdx = Math.floor(seededRandom(baseSeed+8888) * EXTRA_EMOJIS.length);
      tile.textContent = EXTRA_EMOJIS[emojiIdx];
    }
  }

  tile.addEventListener("click", () => handleTileClick(tile));
  return tile;
}

function fillScreenWithTiles() {
  world.innerHTML = "";
  for (let r = 0; r < 3; r++) {
    for (let c = 0; c < 3; c++) {
      world.appendChild(createTileAt(offsetRow + r, offsetCol + c));
    }
  }
}

/* -----------------------------
   TILE WORLD SOUNDS
----------------------------- */

function playTileWorldSound(symbol) {
  switch (symbol) {
    case "üéÅ":
      playGliss(440, 880, 0.4);
      break;
    case "‚≠ê":
      playSpecialTone(1200, 0.3, "triangle");
      break;
    case "üåà":
      playGliss(660, 1320, 0.4);
      break;
    case "üåô":
      playGliss(440, 330, 0.4);
      break;
    case "‚òÄÔ∏è":
      playSpecialTone(880, 0.25, "square");
      break;
    case "üí°":
      playSpecialTone(1200, 0.2, "sine");
      break;
    case "‚ö°":
      playSpecialTone(1500, 0.15, "square");
      break;
    case "‚ùÑÔ∏è":
      playSpecialTone(880, 0.4, "sine");
      break;
    case "üî•":
      playSpecialTone(220, 0.5, "sawtooth");
      break;
    case "üåº":
      playSpecialTone(660, 0.4, "triangle");
      break;
    case "‚¨ÜÔ∏è":
    case "‚¨áÔ∏è":
    case "‚¨ÖÔ∏è":
    case "‚û°Ô∏è":
      playSpecialTone(500, 0.1, "square");
      break;
    default:
      playSpecialTone(400, 0.12, "sine");
      break;
  }
}

/* -----------------------------
   TILE CLICK HANDLING
----------------------------- */

function handleTileClick(tile) {
  const symbol = tile.textContent;

  playTileWorldSound(symbol);

  if (symbol === "üéÅ") {
    triggerSuperPresent();
    return;
  }

  if (symbol === "‚≠ê") {
    triggerStarSwap(tile);
    return;
  }

  if (symbol === "üåà") {
    let index = parseInt(tile.dataset.rainbowIndex || "0", 10);
    index = (index + 1) % RAINBOW_COLORS.length;
    tile.dataset.rainbowIndex = index;
    const newColor = RAINBOW_COLORS[index];
    tile.style.background = newColor;
    tile.dataset.color = newColor;
    return;
  }

  if (symbol === "üåô") {
    document.body.classList.add("dimmed");
    document.body.classList.remove("brightened");
    showMessage("üåô Dim mode");
    return;
  }

  if (symbol === "‚òÄÔ∏è") {
    document.body.classList.add("brightened");
    document.body.classList.remove("dimmed");
    showMessage("‚òÄÔ∏è Bright mode");
    return;
  }

  if (symbol === "üí°") {
    document.body.classList.remove("dimmed", "brightened");
    showMessage("üí° Light mode");
    return;
  }

  if (DIRECTIONS.includes(symbol)) {
    moveInDirection(symbol);
    return;
  }

  if (tile.dataset.color) {
    spreadColorToOthers(tile.dataset.color, tile);
  }
}

/* -----------------------------
   MESSAGE BUBBLE
----------------------------- */

function showMessage(text) {
  message.textContent = text;
  message.classList.add("visible");
  setTimeout(() => {
    message.classList.remove("visible");
  }, 1200);
}

/* -----------------------------
   ‚≠ê STAR SWAP
----------------------------- */

function triggerStarSwap(starTile) {
  const tiles = Array.from(document.querySelectorAll(".tile"))
    .filter(t => t !== starTile);

  if (tiles.length === 0) return;

  const target = tiles[Math.floor(Math.random() * tiles.length)];

  const starColor = starTile.style.background;
  const targetColor = target.style.background;

  starTile.style.background = targetColor;
  target.style.background = starColor;

  starTile.dataset.color = targetColor;
  target.dataset.color = starColor;

  starTile.style.transform = "scale(1.15)";
  target.style.transform = "scale(1.15)";
  setTimeout(() => {
    starTile.style.transform = "scale(1)";
    target.style.transform = "scale(1)";
  }, 150);

  createSparkles(starTile);
  createSparkles(target);
}

/* -----------------------------
   COLOR SPREAD
----------------------------- */

function spreadColorToOthers(color, clickedTile) {
  const tiles = Array.from(document.querySelectorAll(".tile"))
    .filter(t => t !== clickedTile);

  const randomTiles = tiles.sort(() => Math.random() - 0.5).slice(0, 3);

  randomTiles.forEach(t => {
    t.style.background = color;
    t.dataset.color = color;
  });
}

/* -----------------------------
   MOVEMENT
----------------------------- */

function moveInDirection(symbol) {
  if (symbol === "‚¨ÜÔ∏è") offsetRow -= 1;
  if (symbol === "‚¨áÔ∏è") offsetRow += 1;
  if (symbol === "‚¨ÖÔ∏è") offsetCol -= 1;
  if (symbol === "‚û°Ô∏è") offsetCol += 1;

  world.classList.remove("move-up","move-down","move-left","move-right");
  if (symbol === "‚¨ÜÔ∏è") world.classList.add("move-up");
  if (symbol === "‚¨áÔ∏è") world.classList.add("move-down");
  if (symbol === "‚¨ÖÔ∏è") world.classList.add("move-left");
  if (symbol === "‚û°Ô∏è") world.classList.add("move-right");

  setTimeout(() => {
    fillScreenWithTiles();
    world.classList.remove("move-up","move-down","move-left","move-right");
  }, 250);
}

window.addEventListener("wheel", (event) => {
  if (document.getElementById("tile-world-container").style.display !== "block") return;

  event.preventDefault();
  if (event.deltaY > 0) moveInDirection("‚¨áÔ∏è");
  else moveInDirection("‚¨ÜÔ∏è");
}, { passive: false });

/* -----------------------------
   SUPER PRESENT ‚Äî CONFETTI + CASCADE + SPARKLES
----------------------------- */

function triggerSuperPresent() {
  launchConfetti();
  triggerColorCascadeWithSparkles();
}

function launchConfetti() {
  const container = document.createElement("div");
  container.style.position = "fixed";
  container.style.top = "0";
  container.style.left = "0";
  container.style.width = "100vw";
  container.style.height = "100vh";
  container.style.pointerEvents = "none";
  container.style.overflow = "hidden";
  container.style.zIndex = "9999";

  document.body.appendChild(container);

  for (let i = 0; i < 80; i++) {
    const piece = document.createElement("div");
    piece.style.position = "absolute";
    piece.style.width = "10px";
    piece.style.height = "10px";
    piece.style.background = randomConfettiColor();
    piece.style.left = Math.random() * window.innerWidth + "px";
    piece.style.top = "-20px";

    const fall = 1000 + Math.random() * 800;

    piece.animate(
      [
        { transform: "translateY(0px) rotate(0deg)" },
        { transform: `translateY(${window.innerHeight + 50}px) rotate(360deg)` }
      ],
      { duration: fall, easing: "ease-out", fill: "forwards" }
    );

    container.appendChild(piece);
  }

  setTimeout(() => container.remove(), 1800);
}

function randomConfettiColor() {
  const colors = ["#FF6B6B","#FFD93D","#4ECDC4","#6A4C93","#2EC4B6","#FF9F1C"];
  return colors[Math.floor(Math.random() * colors.length)];
}

function triggerColorCascadeWithSparkles() {
  const tiles = Array.from(document.querySelectorAll(".tile"));
  const COLORS = ["#FF6B6B","#4ECDC4","#FFD93D","#6A4C93","#FF9F1C","#2EC4B6"];

  tiles.forEach((tile, index) => {
    setTimeout(() => {
      const newColor = COLORS[Math.floor(Math.random() * COLORS.length)];
      tile.style.background = newColor;
      tile.dataset.color = newColor;

      tile.style.transform = "scale(1.1)";
      setTimeout(() => tile.style.transform = "scale(1)", 120);

      createSparkles(tile);
    }, index * 180);
  });
}

/* -----------------------------
   SPARKLES (TILE WORLD)
----------------------------- */

function createSparkles(tile) {
  const rect = tile.getBoundingClientRect();

  const container = document.createElement("div");
  container.style.position = "fixed";
  container.style.left = rect.left + "px";
  container.style.top = rect.top + "px";
  container.style.width = rect.width + "px";
  container.style.height = rect.height + "px";
  container.style.pointerEvents = "none";
  container.style.zIndex = "5000";

  document.body.appendChild(container);

  for (let i = 0; i < 12; i++) {
    const spark = document.createElement("div");
    spark.style.position = "absolute";
    spark.style.width = "6px";
    spark.style.height = "6px";
    spark.style.borderRadius = "50%";
    spark.style.background = randomConfettiColor();
    spark.style.left = rect.width / 2 + "px";
    spark.style.top = rect.height / 2 + "px";

    const angle = Math.random() * Math.PI * 2;
    const dist = 40 + Math.random() * 30;

    spark.animate(
      [
        { transform: "translate(0,0)", opacity: 1 },
        { transform: `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`, opacity: 0 }
      ],
      { duration: 500 + Math.random()*300, easing: "ease-out", fill: "forwards" }
    );

    container.appendChild(spark);
  }

  setTimeout(() => container.remove(), 700);
}
</script>

</body>
</html>